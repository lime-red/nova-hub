<!-- templates/admin/client_config.html -->
{% extends "base.html" %}
{% block title %}Client Configuration - Nova Hub{% endblock %}

{% block breadcrumb %}
<nav class="breadcrumb">
    <ol>
        <li><a href="/dashboard">Dashboard</a></li>
        <li><a href="/admin">Admin</a></li>
        <li><a href="/admin/clients">Clients</a></li>
        <li>{{ client.bbs_name }} Configuration</li>
    </ol>
</nav>
{% endblock %}

{% block content %}
<h1>Client Configuration for {{ client.bbs_name }}</h1>

<article>
    <h2>Configuration Details</h2>
    <table>
        <tr>
            <th>BBS Name</th>
            <td>{{ client.bbs_name }}</td>
        </tr>
        <tr>
            <th>Client ID</th>
            <td><code>{{ client.client_id }}</code></td>
        </tr>
    </table>
</article>

<article>
    <h3>Client Configuration File</h3>
    <p>Save this as <code>config.toml</code> in the client application directory.</p>

    <pre><code id="config-content">[hub]
url = "{{ hub_url }}"
client_id = "{{ client.client_id }}"
client_secret = "YOUR_CLIENT_SECRET_HERE"  # Use the secret from creation/regeneration

[bbs]
name = "{{ client.bbs_name }}"

# League-specific configuration
# BBS ID is assigned per league when you add this client to a league in the admin interface
# Example for BRE league 555:
# [leagues.BRE.555]
# enabled = true
# bbs_index = 2  # Your BBS ID for this specific league (integer 1-255)
# outbound_dir = "/path/to/bre/555/outbound"
# inbound_dir = "/path/to/bre/555/inbound"
</code></pre>

    <button onclick="copyConfig()">Copy Configuration</button>
</article>

<article class="alert-box warning">
    <h3>⚠️ Client Secret Required</h3>
    <p>You need to insert the client secret in the configuration above. The secret is:</p>
    <ul>
        <li><strong>Only shown once</strong> when you first create the client</li>
        <li><strong>Only shown once</strong> when you regenerate the secret</li>
        <li>Not stored in plain text - only a bcrypt hash is kept (security best practice)</li>
        <li>Cannot be retrieved after creation - only regenerated</li>
    </ul>
    <p><strong>If you don't have the secret:</strong> Use the <strong>Regenerate Secret</strong> button below to generate a new one (this will invalidate the old secret).</p>
</article>

<article>
    <h3>Setup Instructions</h3>
    <ol>
        <li>Copy the configuration above</li>
        <li>Insert the <code>client_secret</code> (from creation or regeneration)</li>
        <li>Add this client to one or more leagues via the League admin interface</li>
        <li>Configure each league section with the BBS ID assigned to this client for that league</li>
        <li>Update the packet directory paths for each league</li>
        <li>Save as <code>config.toml</code> in the client directory</li>
        <li>Test the connection: <code>python client.py --test</code></li>
    </ol>
</article>

<div style="display: flex; gap: 1rem;">
    <a href="/admin/clients/{{ client.id }}/regenerate-secret" role="button" class="contrast">
        Regenerate Secret
    </a>
    <a href="/admin/clients" role="button" class="secondary">
        Back to Clients
    </a>
</div>

<script>
function copyConfig() {
    const config = document.getElementById('config-content').textContent;
    navigator.clipboard.writeText(config).then(() => {
        alert('Configuration copied to clipboard!');
    });
}
</script>

{% endblock %}
